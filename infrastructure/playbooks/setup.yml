---
- name: Set up WebBBS development/production deploy_environment
  hosts: all
  become: yes
  vars_files:
    - ../group_vars/all.yml

  pre_tasks:
    - name: Display deploy_environment
      debug:
        msg: "Setting up {{ deploy_environment }} deploy_environment on {{ inventory_hostname }}"

  roles:
    - role: ../roles/common
    - role: ../roles/php
    - role: ../roles/postgresql
    - role: ../roles/nodejs
    - role: ../roles/mercure
    - role: ../roles/apache

  post_tasks:
    - name: Display setup complete message
      debug:
        msg: |
          Setup complete!

          Environment: {{ deploy_environment }}
          Project root: {{ project_root }}

          PHP version: {{ php_version }}
          PostgreSQL version: {{ postgresql_version }}
          Node.js version: {{ nodejs_version }}

          Database: {{ database_name }}
          Database user: {{ database_user }}

          Next steps:
          {% if deploy_environment == 'development' %}
          1. Add SSH key to GitHub (shown above)
          2. Clone repository: git clone {{ git_repository }} {{ project_root }}
          3. Initialize Symfony: cd {{ project_root }} && symfony new api --webapp
          4. Initialize Angular: cd {{ project_root }} && ng new frontend --routing --style=scss --standalone
          5. Start dev servers:
             - Symfony: cd {{ project_root }}/api && symfony server:start --port=8001
             - Angular: cd {{ project_root }}/frontend && ng serve --port=4201
          {% else %}
          1. Run deploy.yml to pull code and build
          {% endif %}
