# Development configuration - proxies to dev servers

# API - proxy to Symfony dev server
Listen {{ apache_api_port }}
<VirtualHost *:{{ apache_api_port }}>
    ServerName localhost

    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:8001/
    ProxyPassReverse / http://127.0.0.1:8001/

    RequestHeader set X-Forwarded-Proto "http"
</VirtualHost>

# Frontend - proxy to Angular dev server
Listen {{ apache_frontend_port }}
<VirtualHost *:{{ apache_frontend_port }}>
    ServerName localhost

    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:4201/
    ProxyPassReverse / http://127.0.0.1:4201/

    # WebSocket support for Angular live reload
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*) ws://127.0.0.1:4201/$1 [P,L]
</VirtualHost>

# Mercure - proxy to Mercure hub
Listen 3001
<VirtualHost *:3001>
    ServerName localhost

    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:{{ mercure_port }}/
    ProxyPassReverse / http://127.0.0.1:{{ mercure_port }}/

    # WebSocket/SSE support for Mercure
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*) ws://127.0.0.1:{{ mercure_port }}/$1 [P,L]

    ProxyTimeout 86400
</VirtualHost>
