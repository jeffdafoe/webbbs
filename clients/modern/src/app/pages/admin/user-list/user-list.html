<app-layout>
    <div class="page-header">
        <h2>User Management</h2>
    </div>

    <div class="search-bar">
        <input
            type="text"
            placeholder="Search users..."
            [ngModel]="search()"
            (ngModelChange)="search.set($event)"
            (keyup.enter)="onSearch()"
        />
        <button (click)="onSearch()">Search</button>
    </div>

    @if (loading()) {
        <p class="status-message">Loading...</p>
    }

    @if (!loading() && users().length === 0) {
        <p class="status-message">No users found.</p>
    }

    @if (users().length > 0) {
        <table class="user-table">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Last Login</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @for (user of users(); track user.id) {
                    <tr>
                        <td class="username">{{ user.username }}</td>
                        <td>{{ user.email || '-' }}</td>
                        <td>
                            <span class="role-badge" [attr.data-role]="roleLabel(user.roles).toLowerCase()">
                                {{ roleLabel(user.roles) }}
                            </span>
                        </td>
                        <td>
                            @if (user.isActive) {
                                <span class="status-active">Active</span>
                            } @else {
                                <span class="status-inactive">Inactive</span>
                            }
                        </td>
                        <td>{{ user.createdAt | date:'short' }}</td>
                        <td>{{ user.lastLoginAt ? (user.lastLoginAt | date:'short') : 'Never' }}</td>
                        <td>
                            <a [routerLink]="['/admin/users', user.id]" class="btn-edit">Edit</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <div class="pagination">
            <button (click)="previousPage()" [disabled]="page() <= 1">Previous</button>
            <span>Page {{ page() }} of {{ totalPages() }} ({{ total() }} users)</span>
            <button (click)="nextPage()" [disabled]="page() >= totalPages()">Next</button>
        </div>
    }
</app-layout>
